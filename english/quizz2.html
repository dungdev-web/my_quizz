<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üéß Listening Dictation Practice</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px;
        line-height: 1.6;
        background: #f8f9fa;
      }
      h2 {
        color: #007bff;
      }
      .question-block {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-width: 600px;
      }
      input {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding-bottom: 50px;
        white-space: nowrap;
      }
      button {
        margin: 10px 5px;
        padding: 10px 14px;
        border: none;
        border-radius: 6px;
        background: #007bff;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .correct {
        color: green;
        font-weight: bold;
      }
      .wrong {
        color: red;
        font-weight: bold;
      }
      .answer {
        background: #f1f1f1;
        padding: 8px;
        border-radius: 6px;
        margin-top: 10px;
        display: none;
      }
    </style>
  </head>
  <body>
    <h2>üéß Luy·ªán nghe v√† vi·∫øt l·∫°i c√¢u ti·∫øng Anh</h2>
    <div class="question-block">
      <p id="progress">B√†i 1 / 1</p>
      <p><b>Nghe v√† vi·∫øt l·∫°i ch√≠nh x√°c:</b></p>
      <button id="play-btn">‚ñ∂Ô∏è Nghe</button>
      <button id="check-btn">‚úÖ Ki·ªÉm tra</button>
      <button id="show-answer-btn">üëÅÔ∏è Hi·ªán ƒë√°p √°n</button>
      <button id="pause-btn">‚è∏ T·∫°m d·ª´ng</button>
      <button id="resume-btn">‚ñ∂Ô∏è Ti·∫øp t·ª•c</button>

      <input
        type="text"
        id="answer-input"
        placeholder="Nh·∫≠p c√¢u b·∫°n nghe ƒë∆∞·ª£c..."
      />
      <p id="result"></p>
      <p class="answer" id="correct-answer"></p>
    </div>

    <script>
      let questions = [];
      let currentIndex = 0;
      let voices = [];
      let currentUtterance = null;

      // --- L·∫§Y GI·ªåNG ---
      function loadVoices() {
        voices = window.speechSynthesis.getVoices();
        if (!voices.length) {
          window.speechSynthesis.onvoiceschanged = () => {
            voices = window.speechSynthesis.getVoices();
            console.log(
              "‚úÖ Voices loaded:",
              voices.map((v) => v.name)
            );
          };
        }
      }

      // --- LOAD D·ªÆ LI·ªÜU ---
      async function loadQuestions() {
        try {
          const res = await fetch("reading.json");
          const data = await res.json();
          questions = Array.isArray(data) ? data : [data];
          showQuestion();
        } catch (err) {
          console.error("‚ùå L·ªói t·∫£i reading.json:", err);
        }
      }

      // --- HI·ªÇN TH·ªä B√ÄI ---
      function showQuestion() {
        if (currentIndex >= questions.length) {
          document.querySelector(
            ".question-block"
          ).innerHTML = `<h3>üéâ B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ b√†i!</h3>`;
          return;
        }

        document.getElementById("progress").innerText = `B√†i ${
          currentIndex + 1
        } / ${questions.length}`;
        document.getElementById("answer-input").value = "";
        document.getElementById("result").innerText = "";
        document.getElementById("correct-answer").style.display = "none";
      }

      // --- ƒê·ªåC C√ÇU ---
      function speakText(text) {
        if (!text) return;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "en-US";
        utterance.rate = 0.85;
        utterance.pitch = 1;
        const voice = voices.find((v) => v.lang === "en-US") || voices[0];
        if (voice) utterance.voice = voice;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      }

      // --- KI·ªÇM TRA C√ÇU TR·∫¢ L·ªúI ---
      function checkAnswer() {
        const input = document
          .getElementById("answer-input")
          .value.trim()
          .toLowerCase();
        const correct = questions[currentIndex].question.trim().toLowerCase();
        const result = document.getElementById("result");
        const answerBox = document.getElementById("correct-answer");

        if (input === correct) {
          result.innerHTML =
            "‚úÖ Ch√≠nh x√°c! T·ª± ƒë·ªông chuy·ªÉn sang b√†i ti·∫øp theo...";
          result.className = "correct";
          setTimeout(() => {
            currentIndex++;
            showQuestion();
          }, 2000);
        } else {
          result.innerHTML = "‚ùå Sai r·ªìi! H√£y nghe l·∫°i v√† th·ª≠ l·∫°i.";
          result.className = "wrong";
          answerBox.style.display = "none";
        }
      }

      // --- HI·ªÜN ƒê√ÅP √ÅN ---
      function showAnswer() {
        const correct = questions[currentIndex].question;
        const box = document.getElementById("correct-answer");
        box.innerText = "ƒê√°p √°n: " + correct;
        box.style.display = "block";
         setTimeout(() => {
            currentIndex++;
            showQuestion();
          }, 2000);
      }

      // --- G·∫ÆN N√öT ---
      document.getElementById("play-btn").addEventListener("click", () => {
        const q = questions[currentIndex];
        speakText(q.question);
      });
      document
        .getElementById("check-btn")
        .addEventListener("click", checkAnswer);
      document
        .getElementById("show-answer-btn")
        .addEventListener("click", showAnswer);
      function pauseSpeaking() {
        if (window.speechSynthesis.speaking && !window.speechSynthesis.paused) {
          window.speechSynthesis.pause();
          console.log("‚è∏ ƒê√£ t·∫°m d·ª´ng");
        }
      }

      function resumeSpeaking() {
        if (window.speechSynthesis.paused) {
          window.speechSynthesis.resume();
          console.log("‚ñ∂Ô∏è Ti·∫øp t·ª•c ƒë·ªçc");
        }
      }
      document
        .getElementById("pause-btn")
        .addEventListener("click", pauseSpeaking);
      document
        .getElementById("resume-btn")
        .addEventListener("click", resumeSpeaking);

      // --- KH·ªûI CH·∫†Y ---
      loadVoices();
      loadQuestions();
    </script>
  </body>
</html>
